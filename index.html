<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>AES Decrypt Demo (With IV)</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            max-width: 600px;
            margin: auto;
        }

        textarea,
        input {
            width: 100%;
            margin-bottom: 12px;
            padding: 8px;
        }

        button {
            padding: 10px 16px;
            cursor: pointer;
        }

        pre {
            background: #f4f4f4;
            padding: 12px;
            white-space: pre-wrap;
        }
    </style>
</head>

<body>

    <h2>AES Decrypt (Separate IV)</h2>

    <label>Encrypted Value (Base64)</label>
    <textarea id="encrypted" rows="4"></textarea>

    <label>AES Key (Base64)</label>
    <input id="aesKey" />

    <label>IV (Base64)</label>
    <input id="iv" />

    <button onclick="decrypt()">Decrypt</button>

    <h3>Result</h3>
    <pre id="result"></pre>

    <script>
        const base64ToUint8Array = (base64) =>
            Uint8Array.from(atob(base64), c => c.charCodeAt(0));

        async function decrypt() {
            try {
                const encryptedBase64 = document.getElementById("encrypted").value;
                const aesKeyBase64 = document.getElementById("aesKey").value;
                const ivBase64 = document.getElementById("iv").value;

                if (!encryptedBase64 || !aesKeyBase64 || !ivBase64) {
                    throw new Error("Missing input");
                }

                const cipherBytes = base64ToUint8Array(encryptedBase64);
                const keyBytes = base64ToUint8Array(aesKeyBase64);
                const ivBytes = base64ToUint8Array(ivBase64);

                if (ivBytes.length !== 12) {
                    throw new Error("AES-GCM IV must be 12 bytes");
                }

                const cryptoKey = await crypto.subtle.importKey(
                    "raw",
                    keyBytes,
                    "AES-GCM",
                    false,
                    ["decrypt"]
                );

                const decryptedBuffer = await crypto.subtle.decrypt(
                    {
                        name: "AES-GCM",
                        iv: ivBytes,
                    },
                    cryptoKey,
                    cipherBytes
                );

                const decryptedText = new TextDecoder().decode(decryptedBuffer);
                document.getElementById("result").textContent = decryptedText;

            } catch (err) {
                document.getElementById("result").textContent =
                    "‚ùå Decrypt failed: " + err.message;
            }
        }
    </script>

</body>

</html>